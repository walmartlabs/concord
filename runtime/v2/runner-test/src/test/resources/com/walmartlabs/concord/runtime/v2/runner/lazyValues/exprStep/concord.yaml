flows:
  default:
    - set:
        value: "100"
        lazyValue: "${lazyValuesTask.createLazyValue(value)}"

    - expr: "${value + 123}"
      out: valueResult  # 223 :)

    - expr: "${lazyValue + 123}"
      out: lazyValueResult

    - log: "1 should print `true`: ${valueResult == lazyValueResult}"
    - log: "2 should print `true`: ${valueResult.getClass() == lazyValueResult.getClass()}"
    - log: "3 should print `true`: ${valueResult.getClass().getCanonicalName() == 'java.lang.Long'}"

    - expr: "${lazyValue.trim().length()}"
      out: lazyValueLength

    - log: "4 should print `3`: ${lazyValueLength}"

    - expr: "${lazyValuesTask.createLazyValue('valueFromExpression')}"
      out: outExpressionLazyValue

    - log: "5 should print `valueFromExpression`: ${outExpressionLazyValue}"

    - expr: "${lazyValuesTask.assertNoLazyValuesInArgument( {'myKey': lazyValue} )}"

    - expr: "${lazyValuesTask.createLazyValueInMap('myValue')}"
      out: lazyValueInMap

    - log: "6 should print `myValue`: ${lazyValueInMap.lazy}"

    # should not resolve `lazyValueFromSetStep` value
    - set:
        myMap: "${ {'key': 'value', 'lazyValueFromSetStep': lazyValuesTask.createLazyValueInMap('lazyValueFromSetStep')} }"

    # should not resolve `lazyValueFromExprStep` value
    - expr: "${myMap.put('lazyValueFromExprStep', lazyValuesTask.createLazyValueInMap('lazyValueFromExprStep')) }"

    # should not resolve `lazyValueFromSetStep` value
    - expr: "${myMap.entrySet().stream().toList() }"
      out: myList

    # resolve `lazyValueFromSetStep` here:
    - log: "${myList}"
